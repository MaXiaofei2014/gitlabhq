%h3.page-title
  问题 ##{@issue.iid}

  %span.pull-right.issue-btn-group
    - if can?(current_user, :write_issue, @project)
      = link_to new_project_issue_path(@project), class: "btn btn-grouped", title: "新问题", id: "new_issue_link" do
        %i.fa.fa-plus
        新问题
    - if can?(current_user, :modify_issue, @issue)
      - if @issue.closed?
        = link_to '重新打开', project_issue_path(@project, @issue, issue: {state_event: :reopen }, status_only: true), method: :put,  class: "btn btn-grouped btn-reopen"
      - else
        = link_to '关闭', project_issue_path(@project, @issue, issue: {state_event: :close }, status_only: true), method: :put, class: "btn btn-grouped btn-close", title: "关闭问题"

      = link_to edit_project_issue_path(@project, @issue), class: "btn btn-grouped" do
        %i.fa.fa-pencil-square-o
        编辑

.clearfix
  .votes-holder
    #votes= render 'votes/votes_block', votable: @issue

  .back-link
    = link_to project_issues_path(@project) do
      &larr; 返回问题列表
    %span.milestone-nav-link
      - if @issue.milestone
        |
        %span.light 里程碑
        = link_to project_milestone_path(@project, @issue.milestone) do
          = @issue.milestone.title

.issue-box{ class: issue_box_class(@issue) }
  .state.clearfix
    .state-label
      - if @issue.closed?
        已关闭
      - else
        未关闭

    .creator
      创建时间 #{link_to_member(@project, @issue.author)} #{issue_timestamp(@issue)}

  %h4.title
    = gfm escape_once(@issue.title)

  - if @issue.description.present?
    .description
      .wiki
        = preserve do
          = markdown(@issue.description, parse_tasks: true)
  .context
    %cite.cgray
      = render partial: 'issue_context', locals: { issue: @issue }


- content_for :note_actions do
  - if can?(current_user, :modify_issue, @issue)
    - if @issue.closed?
      = link_to '重新打开问题', project_issue_path(@project, @issue, issue: {state_event: :reopen }, status_only: true), method: :put, class: "btn btn-grouped btn-reopen js-note-target-reopen", title: '重新打开问题'
    - else
      = link_to '关闭问题', project_issue_path(@project, @issue, issue: {state_event: :close }, status_only: true), method: :put, class: "btn btn-grouped btn-close js-note-target-close", title: "关闭问题"

.participants
  %cite.cgray
    = pluralize(@issue.participants.count, '个参与者', '个参与者')
  - @issue.participants.each do |participant|
    = link_to_member(@project, participant, name: false, size: 24)

  .issue-show-labels.pull-right
    - @issue.labels.each do |label|
      = link_to project_issues_path(@project, label_name: label.name) do
        = render_colored_label(label)

.voting_notes#notes= render "projects/notes/notes_with_form"
